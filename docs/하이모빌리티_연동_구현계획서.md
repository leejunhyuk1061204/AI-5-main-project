# 하이모빌리티 클라우드 연동 및 데이터 동기화 계획

사용자의 피드백과 하이모빌리티 샌드박스 응답 결과를 바탕으로 데이터 수집 목표와 동기화 시점을 구체화합니다.

## 1. 현재 구현 현황 및 분석

### 데이터 수집 목표: Odometer (주행거리)
- **핵심 데이터**: `diagnostics.odometer.data.value`
- **활용**: 해당 차량의 **현재 실주행거리**를 가져와 서버에 저장합니다. 이 값은 우리가 이미 구현한 **소모품 진단 로직**의 핵심 입력값(`current_mileage`)이 됩니다. 주행거리가 업데이트될 때마다 소모품의 남은 수명이 자동으로 다시 계산됩니다.

## 2. 수립된 구현 방향

### 하이브리드 차량 등록 및 데이터 연동 전략
- **1단계: 차량 등록 (Static Data API - 5번 활용)**
    - **VIN 기반 자동화**: 사용자가 입력한 VIN으로 Static API를 호출하여 `Manufacturer`, `Model`, `Year`, `Fuel Type` 등 5종의 정적 제원을 자동으로 채웁니다.
    - **Fallback**: 지원하지 않는 차종인 경우, 사용자가 브랜드/모델을 직접 입력할 수 있는 수동 등록 UI로 전환합니다.
- **2단계: 데이터 동기화 (REST API - 1번 활용)**
    - **주기적 데이터 수집**: `odometer`, `engine_oil_life`, `fuel_level` 등 계속 변하는 7종의 동적 데이터를 가져와 소모품 잔여 수명을 계산합니다.
    - **데이터 매핑**: 하이모빌리티의 `"sandbox"` 브랜드 환경을 유지하되, 내부 `Tags` 필드에 실제 브랜드 및 내부 `vehicleId`를 저장하여 관리 연동성을 높입니다.

### 범용 수집 데이터 항목 (12종)
- **정적 데이터 (최초 등록용)**: 브랜드, 모델명, 생산연도, 연료 종류, 엔진 사양, 변속기 종류
- **동적 데이터 (진단/관리용)**: 주행 거리(Odometer), 엔진오일 수명, 연료/배터리 잔량, 타이어 공기압, 위치 정보, 시동 상태, 도어 잠금 상태

## 3. 변경 예정 핵심 코드

### [MODIFY] [CloudAuthService.java](file:///c:/dev/AI/AI-5-main/backend/src/main/java/kr/co/himedia/service/CloudAuthService.java)
- `syncVehicleData(String vin)`: HM API(`autoapi-13`)를 호출하여 `odometer` 값을 추출하고, 해당 차량의 주행거리를 DB에 업데이트한 후 소모품 진단 서비스를 트리거합니다.

## 4. 검증 계획 (수동 테스트)
- `1HMXOBSGK693TJ7JR` VIN으로 호출 시 주행거리 `2050.0km`가 DB의 `vehicle.current_mileage`에 정확히 반영되는지 확인합니다.
