# API ìƒì„¸ ëª…ì„¸ì„œ (v2.0)

> **ë¬¸ì„œ ê°œìš”**: ë³¸ ë¬¸ì„œëŠ” ì‹œìŠ¤í…œ ê°„ í†µì‹  ê·œê²©ì„ ì •ì˜í•˜ë©°, í¬ê²Œ **Client(App) â†” Backend(Java)** ì™€ **Backend(Java) â†” AI Server(Python)** ë‘ ê°€ì§€ íŒŒíŠ¸ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.
> **RabbitMQ**ëŠ” ë‚´ë¶€ ì¸í”„ë¼ í†µì‹ ìš©ì´ë¯€ë¡œ ë³¸ REST API ëª…ì„¸ì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

# Part 1. Frontend â†” Backend API
> **Mobile App**ê³¼ **Java Backend** ê°„ì˜ í†µì‹  ê·œê²©ì…ë‹ˆë‹¤.
> - **Base URL**: `https://api.car-sentry.com/api/v1`
> - **Global Prefix**: ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ ì•ì—ëŠ” ìë™ìœ¼ë¡œ `/api/v1`ì´ ë¶™ìŠµë‹ˆë‹¤. (ì•„ë˜ ê²½ë¡œëŠ” ì´ ì ‘ë‘ì–´ ì´í›„ì˜ ìƒëŒ€ ê²½ë¡œì…ë‹ˆë‹¤.)
> - **Auth**: `Authorization: Bearer {jwt_token}`

### ğŸ“¦ ê³µí†µ ì‘ë‹µ ê·œê²© (Common Response)
ëª¨ë“  API ì‘ë‹µì€ `ApiResponse` ê°ì²´ë¡œ ë˜í•‘ë˜ì–´ ì „ë‹¬ë©ë‹ˆë‹¤.
```json
{
  "success": true,
  "data": { ... },
  "error": null
}
```
- **success**: ìš”ì²­ ì²˜ë¦¬ ì„±ê³µ ì—¬ë¶€ (boolean)
- **data**: ì‹¤ì œ ê²°ê³¼ ë°ì´í„° (ì„±ê³µ ì‹œì—ë§Œ ì¡´ì¬, ì‹¤íŒ¨ ì‹œ null)
- **error**: ì—ëŸ¬ ì •ë³´ (ì‹¤íŒ¨ ì‹œì—ë§Œ ì¡´ì¬, ì„±ê³µ ì‹œ null)
  - `code`: ì—ëŸ¬ ì½”ë“œ
  - `message`: ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€

## 1. ì‚¬ìš©ì ë° ì¸ì¦ (Auth & Users)
> Base Path: `/auth`

### 1.1 íšŒì›ê°€ì… (Signup)
- **POST `/auth/signup` (BE-AU-001)**
- **Request Body**:
  ```json
  {
    "email": "user@example.com",
    "password": "password123",
    "nickname": "carlover"
  }
  ```
- **Response**: `ApiResponse<UserResponse>`
  ```json
  {
    "success": true,
    "data": {
      "userId": "UUID",
      "email": "user@example.com",
      "nickname": "carlover",
      "profileImageBase64": "string (null if empty)"
    },
    "error": null
  }
  ```

### 1.2 ë¡œê·¸ì¸ ë° í† í° (Login & Token)
- **POST `/auth/login` (BE-AU-002)**: JWT í† í° ë°œê¸‰
- **Request Body**:
  ```json
  {
    "email": "user@example.com",
    "password": "password123"
  }
  ```
- **Response**: `ApiResponse<TokenResponse>`
  ```json
  {
    "success": true,
    "data": {
      "accessToken": "ey...",
      "refreshToken": "ey..."
    },
    "error": null
  }
  ```

- **POST `/auth/refresh`**: í† í° ê°±ì‹ 
- **Request Body**: `{ "refreshToken": "string" }`
- **Response**: `ApiResponse<TokenResponse>`

### 1.3 ì‚¬ìš©ì í”„ë¡œí•„ (User Profile)
- **GET `/auth/me` (BE-AU-003)**: ë‚´ í”„ë¡œí•„ ì¡°íšŒ
- **Response**: `ApiResponse<UserResponse>`

- **PATCH `/auth/me` (BE-AU-004)**: í”„ë¡œí•„ ìˆ˜ì •
- **Request Body**: `{ "nickname": "string", "memo": "string" }`

- **POST `/auth/me/image`**: í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
- **Request**: `Multipart/form-data` íŒŒë¼ë¯¸í„° `file` (ì´ë¯¸ì§€ íŒŒì¼)

- **PATCH `/auth/fcm-token`**: FCM í† í° ì „ìš© ê°±ì‹ 
- **Request Body**: `{ "fcmToken": "string" }`

- **DELETE `/auth/me` (BE-AU-007)**: íšŒì› íƒˆí‡´ (Soft Delete)

---

## 2. ì°¨ëŸ‰ ê´€ë¦¬ (Vehicles)
> Base Path: `/vehicles`

### 2.1 ì°¨ëŸ‰ ë“±ë¡
- **POST `/vehicles` (BE-VH-001)**: ì°¨ëŸ‰ ìˆ˜ë™ ë“±ë¡
- **Request Body**:
  ```json
  {
    "manufacturer": "Hyundai",
    "modelName": "Avante",
    "modelYear": 2022,
    "fuelType": "GASOLINE",
    "totalMileage": 15000.5,
    "carNumber": "123ê°€4567",
    "nickname": "My Car (Optional)",
    "memo": "Daily drive (Optional)",
    "obdDeviceId": "OBD-XYZ-001 (Optional)",
    "consumables": [
      {
        "code": "ENGINE_OIL",
        "lastReplacedAt": "2024-01-01T00:00:00",
        "lastReplacedMileage": 10000.0
      }
    ]
  }
  ```
- **Note**: `consumables` ë¦¬ìŠ¤íŠ¸ëŠ” ì„ íƒ ì‚¬í•­ì…ë‹ˆë‹¤. ì…ë ¥í•˜ì§€ ì•Šì€ ì†Œëª¨í’ˆ(9ì¢… ì „ì²´ ëŒ€ìƒ)ì€ ì‹œìŠ¤í…œ í‘œì¤€ ì£¼ê¸°ì— ë”°ë¼ ìë™ìœ¼ë¡œ ìƒíƒœê°€ ì¶”ë¡ ë˜ì–´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
- **Response**: `ApiResponse<VehicleDto.Response>`
  ```json
  {
    "success": true,
    "data": {
      "vehicleId": "UUID",
      "userId": "UUID",
      "manufacturer": "Hyundai",
      "modelName": "Avante",
      "modelYear": 2022,
      "fuelType": "GASOLINE",
      "totalMileage": 15000.5,
      "carNumber": "123ê°€4567",
      "nickname": "My Car",
      "memo": "Daily drive",
      "isPrimary": false,
      "registrationSource": "MANUAL",
      "obdDeviceId": "OBD-XYZ-001"
    },
    "error": null
  }
  ```

- **POST `/vehicles/obd` (BE-VH-002)**: OBD ê¸°ë°˜ ì°¨ëŸ‰ ìë™ ë“±ë¡ (VIN ìë™ ë§¤í•‘)
- **Request Body**: `{ "vin": "17_CHAR_VIN_CODE" }`
- **Response**: `ApiResponse<VehicleDto.Response>`

### 2.2 ì°¨ëŸ‰ ì¡°íšŒ ë° ìˆ˜ì •
- **GET `/vehicles` (BE-VH-004)**: ë³´ìœ  ì°¨ëŸ‰ ëª©ë¡ ì¡°íšŒ
- **Response**: `ApiResponse<List<VehicleDto.Response>>`

- **GET `/vehicles/{id}` (BE-VH-004)**: ì°¨ëŸ‰ ìƒì„¸ ì •ë³´ ì¡°íšŒ
- **Response**: `ApiResponse<VehicleDto.Response>`

- **PUT `/vehicles/{id}` (BE-VH-004)**: ì°¨ëŸ‰ ì •ë³´ ìˆ˜ì • (ë³„ëª…, ë©”ëª¨)
- **Request Body**: `{ "nickname": "string", "memo": "string" }`

- **PATCH `/vehicles/primary` (BE-VH-006)**: ëŒ€í‘œ ì°¨ëŸ‰ ì„¤ì •
- **Request Body**: `{ "vehicleId": "UUID" }`

- **DELETE `/vehicles/{id}` (BE-VH-007)**: ì°¨ëŸ‰ ì‚­ì œ (Soft Delete)

### 2.3 ë§ˆìŠ¤í„° ë°ì´í„° (Master Data)
> Base Path: `/master`

- **GET `/master/manufacturers` (BE-VH-003)**: ì œì¡°ì‚¬ ëª©ë¡ ì¡°íšŒ (ì˜ˆ: Hyundai, Kia)
- **Response**: `ApiResponse<List<String>>`

- **GET `/master/models` (BE-VH-003)**: ëª¨ë¸ ëª©ë¡ ì¡°íšŒ (íŒŒë¼ë¯¸í„°: manufacturer)
- **Response**: `ApiResponse<List<CarModelDto>>`

---

## 3. ì •ë¹„ ë° ì†Œëª¨í’ˆ (Maintenance)
> Base Path: `/vehicles`

### 3.1 ì •ë¹„ ì´ë ¥ ê´€ë¦¬
- **POST `/vehicles/{vehicleId}/maintenance` (BE-MT-001)**: ì •ë¹„ ê¸°ë¡ ë“±ë¡ (ë‹¤ì¤‘ ë“±ë¡ ì§€ì›)
- **Request Body**: `List<MaintenanceHistoryRequest>`
  ```json
  [
    {
      "maintenanceDate": "2024-01-17",
      "mileageAtMaintenance": 15500.0,
      "consumableItemId": 1,
      "isStandardized": true,
      "shopName": "Service Center",
      "cost": 85000,
      "ocrData": "string (Optional)",
      "memo": "First oil change"
    }
  ]
  ```
- **Response**: `ApiResponse<List<MaintenanceHistoryResponse>>`

- **GET `/vehicles/{vehicleId}/maintenance`**: ì°¨ëŸ‰ë³„ ì •ë¹„ ì´ë ¥ ëª©ë¡ ì¡°íšŒ (ìµœê·¼ìˆœ)
- **Response**: `ApiResponse<List<MaintenanceHistoryResponse>>`

- **POST `/vehicles/maintenance/ocr` (BE-MT-003)**: ì •ë¹„ ì˜ìˆ˜ì¦ ë¶„ì„ (OCR)
- **Request**: `Multipart/form-data` íŒŒë¼ë¯¸í„° `file` (ì˜ìˆ˜ì¦ ì´ë¯¸ì§€)
- **Response**: `ApiResponse<MaintenanceReceiptResponse>`

- **GET `/vehicles/{vehicleId}/consumables`**: ì£¼ìš” ì†Œëª¨í’ˆ ìƒíƒœ ë° ìˆ˜ëª… ì˜ˆì¸¡ ì¡°íšŒ
- **Response**: `ApiResponse<List<ConsumableStatusResponse>>`
  ```json
  {
    "success": true,
    "data": [
      {
        "item": "ENGINE_OIL",
        "itemDescription": "ì—”ì§„ ì˜¤ì¼",
        "remainingLifePercent": 85.5,
        "lastMaintenanceDate": "2024-01-17",
        "lastMaintenanceMileage": 15500.0,
        "replacementIntervalMileage": 10000.0,
        "replacementIntervalMonths": 12,
        "predictedReplacementDate": "2025-01-17"
      }
    ]
  }
  ```

---

## 4. í…”ë ˆë©”íŠ¸ë¦¬ ë° ìš´ì „ ë¶„ì„ (Telemetry)
> Base Path: `/telemetry`

### 4.1 OBD ë°ì´í„° ìˆ˜ì§‘
- **POST `/telemetry/batch` (BE-TD-002)**: OBD ë¡œê·¸ ë°°ì¹˜ ì—…ë¡œë“œ (3ë¶„ ì£¼ê¸°)
- **Request Body**: `List<ObdLogDto>` (timestamp, vehicleId, rpm, speed ë“± í¬í•¨)
- **Response**: `ApiResponse<Void>`

- **GET `/telemetry/status/{vehicleId}` (BE-TD-006)**: ì°¨ëŸ‰ ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ ì¡°íšŒ
- **Response**: `ApiResponse<ConnectionStatusDto>` (`connected`, `lastDataTime`, `statusMessage`)

- **POST `/telemetry/status/disconnect`**: ì°¨ëŸ‰ ìˆ˜ë™ ì—°ê²° í•´ì œ (ì„¸ì…˜ ê°•ì œ ì¢…ë£Œ)
- **Request Body**: `{ "vehicleId": "UUID" }`

---

## 5. ì£¼í–‰ ì„¸ì…˜ ê´€ë¦¬ (Trips)
> Base Path: `/trips`

### 5.1 ì£¼í–‰ ì‹œì‘ ë° ì¢…ë£Œ
- **POST `/trips/start` (BE-TD-001)**: ì£¼í–‰ ì„¸ì…˜ ì‹œì‘
- **Request Body**: `{ "vehicleId": "UUID" }`
- **Response**: `ApiResponse<TripSummary>`

- **POST `/trips/end` (BE-TD-004)**: ì£¼í–‰ ì„¸ì…˜ ì¢…ë£Œ ë° ìš”ì•½ ì €ì¥
- **Request Body**: `{ "tripId": "UUID" }`
- **Response**: `ApiResponse<TripSummary>`
  ```json
  {
    "success": true,
    "data": {
      "tripId": "UUID",
      "vehicleId": "UUID",
      "startTime": "2024-01-17T14:30:00",
      "endTime": "2024-01-17T15:00:00",
      "distance": 15.5,
      "driveScore": 95,
      "averageSpeed": 45.0,
      "topSpeed": 85.0
    }
  }
  ```

- **GET `/trips` (BE-TD-005)**: ë‚´ ì£¼í–‰ ì´ë ¥ ëª©ë¡ ì¡°íšŒ (íŒŒë¼ë¯¸í„°: vehicleId)
- **Note**: 100m ë¯¸ë§Œì˜ ì§§ì€ ì£¼í–‰ì€ ëª©ë¡ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.
- **Response**: `ApiResponse<List<TripSummary>>`

---

## 6. AI ì§„ë‹¨ ë° ë¦¬í¬íŠ¸ (AI Diagnosis)
> Base Path: `/ai`

### 6.1 í†µí•© ì§„ë‹¨ ìš”ì²­
- **POST `/ai/diagnose/unified`**: ë©€í‹°ëª¨ë‹¬ í†µí•© ì§„ë‹¨ ìš”ì²­ (Multipart)
- **Request (Multipart)**:
  - `request`: `UnifiedDiagnosisRequestDto` (JSON String)
  - `audioFile`: ì˜¤ë””ì˜¤ íŒŒì¼ (Optional)
  - `visionFile`: ì´ë¯¸ì§€ íŒŒì¼ (Optional)
- **Response**: `ApiResponse<DiagnosisResponseDto>`

- **POST `/ai/diagnose` (BE-AI-001)**: ì¼ë°˜ ì§„ë‹¨ ìš”ì²­ (DTC, Anomaly ë“±)
- **Request Body**: `DiagnosisRequestDto` (vehicleId, type, mediaUrl ë“±)
- **Response**: `ApiResponse<DiagnosisResponseDto>`

- **GET `/ai/diagnose/{session_id}` (BE-AI-005) [êµ¬í˜„ ì˜ˆì •]**: ì§„ë‹¨ ê²°ê³¼ ìƒì„¸ ì¡°íšŒ
- **GET `/ai/missions/{session_id}` (BE-AI-006) [êµ¬í˜„ ì˜ˆì •]**: ì¶”ê°€ ì¦ê±° ìš”ì²­ ë¯¸ì…˜ í™•ì¸

### 6.2 ë¯¸ë””ì–´ ì—…ë¡œë“œ
- **POST `/ai/media/upload`**: ì§„ë‹¨ìš© ë¯¸ë””ì–´ íŒŒì¼ ì—…ë¡œë“œ (S3/Local)
- **Request**: `Multipart/form-data` (file)
- **Response**: `ApiResponse<Map<String, String>>` (`{ "url": "..." }`)

### 6.3 ì§€ì‹ ë² ì´ìŠ¤ ê²€ìƒ‰ (RAG)
- **GET `/ai/knowledge/search` (BE-AI-005)**: ìë™ì°¨ ìê°€ì§„ë‹¨ ë° ì§€ì‹ Q&A
- **Query**: `query` (ì§ˆë¬¸ ë¬¸ìì—´)
- **Response**: `ApiResponse<List<KnowledgeBaseResponse>>`

---

## 7. ë¶€ê°€ ê¸°ëŠ¥ ë° ì•Œë¦¼ (Features & Notifications)
> Base Path: (ê³µí†µ)

- **GET `/notifications` (BE-NT-001)**: ì•Œë¦¼ ì„¼í„° ë‚´ì—­ ì¡°íšŒ
- **Response**: `ApiResponse<List<Notification>>`

- **PATCH `/notifications/{id}/read`**: ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬
- **Response**: `ApiResponse<String>`

- **GET `/insights/personal` (BE-TD-008) [êµ¬í˜„ ì˜ˆì •]**: ê°œì¸í™” ìš´ì „/ì •ë¹„ ì¸ì‚¬ì´íŠ¸ ì¡°íšŒ
- **GET `/vehicles/{id}/anomalies` (BE-TD-006) [êµ¬í˜„ ì˜ˆì •]**: ì´ìƒ ì§•í›„ ê°ì§€ ì´ë ¥ ì¡°íšŒ

---

## 8. ì–´ë“œë¯¼ ë° í…ŒìŠ¤íŠ¸ (Admin & Test)
> Base Path: `/admin`, `/ai/test`

- **GET `/admin/users`**: ì „ì²´ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ (ê´€ë¦¬ììš©)
- **GET `/admin/vehicles`**: ì „ì²´ ë“±ë¡ ì°¨ëŸ‰ ëª©ë¡ ì¡°íšŒ

- **GET `/ai/test/knowledge/search`**: RAG ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ (ì„ë² ë”© ë° ë²¡í„° ê²€ìƒ‰ ê²€ì¦ìš©)
- **POST `/ai/test/dtc/report`**: DTC ë°œìƒ ê°•ì œ ë¦¬í¬íŠ¸ í…ŒìŠ¤íŠ¸




# Part 2. Backend â†” AI Server API
> **Java Backend**ê°€ **Python AI Server**ë¡œ ì¶”ë¡ ì„ ìš”ì²­í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë‚´ë¶€ APIì…ë‹ˆë‹¤.
> - **Base URL**: `http://host.docker.internal:8001/api/v1/connect`
> - **Protocol**: HTTP/1.1 (Wait for Response)

### 1. Vision Analysis (YOLOv8)
- **POST `/predict/visual`**
    - **Description**: ì°¨ëŸ‰ ì™¸ê´€ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì†ìƒ ë¶€ìœ„ íƒì§€.
    - **Request (Multipart)**:
        - `file`: ì´ë¯¸ì§€ íŒŒì¼ (Binary)
    - **Response (JSON)**:
        ```json
        //1. ì—”ì§„ë£¸
        {
          "status": "WARNING", //NORMAL, WARNING, CRITICAL, ERROR(ëª¨ë¦„)->LLMìœ¼ë¡œ ì´ë™
          "analysis_type": "SCENE_ENGINE", //SCENE_ENGINE, SCENE_DASHBOARD, SCENE_EXTERIOR, SCENE_TIRE
          "category": "ENGINE_ROOM", 
          "data": {
            "vehicle_type": "ICE", //(ICE: ë‚´ì—°ê¸°ê´€ / EV: ì „ê¸°ì°¨) - ë¶€í’ˆì„ ë³´ê³  ë¶„ë¥˜
            "parts_detected": 2, // ê°ì§€ëœ ë¶€í’ˆ ìˆ˜
            "anomalies_found": 1, // ì´ìƒ ì§•í›„ ë¶€í’ˆ ìˆ˜
            "results": [
              {
                "part_name": "Engine_Oil_Fill_Cap",
                "bbox": [
                  697,
                  227,
                  875,
                  348
                ],
                "is_anomaly": true,
                "anomaly_score": 0.85,
                "threshold": 0.7,
                "defect_label": "Oil Leakage", //ê²°í•¨ ëª…ì¹­
                "severity": "NORMAL",
                "description": "Engine_Oil_Fill_Capì€(ëŠ”) ì •ìƒ ìƒíƒœì…ë‹ˆë‹¤.",
                "recommended_action": "ì¡°ì¹˜ ë¶ˆí•„ìš”"
              }
            ]
          }
        }

        /*
        vehicle_type êµ¬ë¶„ / part_name

        ICE ì „ìš©(ìŠ¹ìš©ì°¨)
        : Engine_Oil_Fill_Cap, Engine_Oil_Dip_Stick, Engine_Cover, Oil_Filter, Oil_Filter_Housing, Air_Filter, Air_Filter_Cover, Alternator, Transmission_Oil_Dip_Stick, ATF_Oil_Reservoir, Clutch_Fluid_Reservoir, Cold_Air_Intake	
        
        EV ì „ìš©(ì „ê¸°ì°¨)
        :Electric_Motor, Inverter_Coolant_Reservoir, Secondary_Coolant_Reservoir, Intercooler_Coolant_Reservoir	
        ê³µí†µ ë¶€í’ˆ	
        : Battery, Radiator, Radiator_Cap, Engine_Coolant_Reservoir, Brake_Fluid, Windshield_Wiper_Fluid, Fuse_Box, ABS_Unit, Power_Steering_Reservoir, Cabin_Air_Filter_Housing	
        */

        // 2. ê³„ê¸°íŒ ë¶„ì„ (SCENE_DASHBOARD)
        {
          "status": "CRITICAL", // ì‹œìŠ¤í…œ ìµœì¢… íŒë‹¨: NORMAL, WARNING, CRITICAL
          "analysis_type": "SCENE_DASHBOARD",
          "category": "DASHBOARD",
          "data": {
            "detected_count": 2,
            "detections": [
              {
                "label": "Engine Oil Pressure", // ê²½ê³ ë“± ëª…ì¹­
                "color_severity": "RED", // ë¹¨ê°•(ì¦‰ì‹œ ì •ì§€), ë…¸ë‘(ì ê²€), ì´ˆë¡(ìƒíƒœ)
                "confidence": 0.95,
                "is_blinking": false, // ì ë©¸ ì—¬ë¶€ (í•´ì„ ê°€ëŠ¥ ì‹œ)
                "meaning": "ì—”ì§„ ì˜¤ì¼ ì••ë ¥ì´ ë‚®ìŒ", // LLMì´ í•´ì„í•œ ì˜ë¯¸
                "bbox": [450, 300, 50, 50] // [x, y, w, h] normalized coordinates
              },
              {
                "label": "Low Tire Pressure (TPMS)",
                "color_severity": "YELLOW",
                "confidence": 0.92,
                "meaning": "íƒ€ì´ì–´ ê³µê¸°ì•• ë¶€ì¡±",
                "bbox": [120, 250, 45, 45]
              }
            ],
            "integrated_analysis": {
              "severity_score": 9, // 1~10ì  ì²™ë„
              "description": "ì—”ì§„ ì˜¤ì¼ ì••ë ¥ ê²½ê³ ë“±(ì ìƒ‰)ì´ ê°ì§€ë˜ì–´ ë§¤ìš° ìœ„í—˜í•œ ìƒíƒœì…ë‹ˆë‹¤. íƒ€ì´ì–´ ê³µê¸°ì•• ë¬¸ì œë„ ë™ë°˜ë˜ì—ˆìŠµë‹ˆë‹¤.",
            },
            "recommendation": {
              "primary_action": "ì¦‰ì‹œ ì•ˆì „í•œ ê³³ì— ì •ì°¨ í›„ ì‹œë™ì„ ë„ì„¸ìš”.",
            }
          }
        }
        /*
        ğŸš¨ 1. RED (Critical - ì¦‰ì‹œ ìš´í–‰ ì¤‘ë‹¨) status: "CRITICAL"ë¡œ ì „í™˜í•´ì•¼ í•˜ëŠ” ë¼ë²¨
        Engine Oil Pressure: ì—”ì§„ ì˜¤ì¼ ì••ë ¥ ì €í•˜ì¦‰ì‹œ ì •ì°¨ ë° ì—”ì§„ ì •ì§€
        Engine Overheating: ëƒ‰ê°ìˆ˜ ì˜¨ë„ ê³¼ì—´ì¦‰ì‹œ ì •ì°¨ ë° ëƒ‰ê°
        Brake System: ë¸Œë ˆì´í¬ ì•¡ ë¶€ì¡± / ì£¼ì°¨ ë¸Œë ˆì´í¬ë¸Œë ˆì´í¬ ì‹œìŠ¤í…œ ì¦‰ì‹œ ì ê²€
        Battery / Charging: ë°°í„°ë¦¬ ì¶©ì „ ì‹œìŠ¤í…œ ì´ìƒë°œì „ê¸° ì ê²€ í•„ìš”
        Airbag / SRS: ì—ì–´ë°± ì‹œìŠ¤í…œ ì´ìƒì¶©ëŒ ì‹œ ì—ì–´ë°± ë¯¸ì „ê°œ ìœ„í—˜
        Door / Hood Open: ë¬¸/ë³¸ë„¤íŠ¸ ì—´ë¦¼ì£¼í–‰ ì „ íì‡„ í™•ì¸

        âš ï¸ 2. YELLOW status: "WARNING"ì— í•´ë‹¹
        Check Engine (MIL): ì—”ì§„ ë° ë°°ì¶œê°€ìŠ¤ ì œì–´ ì´ìƒì •ë¹„ì†Œ ë°©ë¬¸ í›„ ìŠ¤ìºë„ˆ ì§„ë‹¨
        ABS: ì•ˆí‹°ë½ ë¸Œë ˆì´í¬ ì‹œìŠ¤í…œ ì´ìƒê¸‰ì œë™ ì‹œ ë¯¸ë„ëŸ¬ì§ ì£¼ì˜
        Low Tire Pressure: íƒ€ì´ì–´ ê³µê¸°ì•• ì €í•˜ (TPMS)ê³µê¸°ì•• ë³´ì¶© ë° í‘í¬ í™•ì¸
        Electronic Stability (ESC): ì°¨ì²´ ìì„¸ ì œì–´ ì¥ì¹˜ ì´ìƒë¯¸ë„ëŸ¬ìš´ ê¸¸ ì£¼í–‰ ì‹œ ì£¼ì˜
        Low Fuel Level: ì—°ë£Œ ë¶€ì¡±ì¦‰ì‹œ ì£¼ìœ  í•„ìš”
        Brake Pad Wear: ë¸Œë ˆì´í¬ íŒ¨ë“œ ë§ˆëª¨íŒ¨ë“œ êµì²´ ì£¼ê¸° í™•ì¸
        Master Warning: í†µí•© ê²½ê³  (ê¸°íƒ€ ê²°í•¨)ì •ë³´ì°½ì˜ ìƒì„¸ ë©”ì‹œì§€ í™•ì¸ í•„ìš”

        âœ… 3. GREEN / BLUE status: "NORMAL"ì— í•´ë‹¹
        Turn Signal: ë°©í–¥ ì§€ì‹œë“±ì¢Œ/ìš° ì‘ë™ ìƒíƒœ
        High Beam: ìƒí–¥ë“± ì‘ë™ì•¼ê°„ ì£¼í–‰ ì‹œ ìƒëŒ€ ì°¨ëŸ‰ ì£¼ì˜
        Fog Light: ì•ˆê°œë“± ì‘ë™ê°€ì‹œê±°ë¦¬ ë¯¸í™•ë³´ ì‹œ ì‚¬ìš©
        Cruise Control: í¬ë£¨ì¦ˆ ì»¨íŠ¸ë¡¤ í™œì„±í™”ì •ì† ì£¼í–‰ ì¥ì¹˜ ìƒíƒœ
        ECO / Sport Mode: ì£¼í–‰ ëª¨ë“œ í‘œì‹œí˜„ì¬ ì„¤ì •ëœ ë“œë¼ì´ë¸Œ ëª¨ë“œ
        */

        // 3. ì°¨ëŸ‰ ì™¸ê´€ ë¶„ì„ (SCENE_EXTERIOR)
        {
          "status": "WARNING", // NORMAL, WARNING, CRITICAL, ERROR
          "analysis_type": "SCENE_EXTERIOR",
          "category": "EXTERIOR",
          "data": {
            "damage_found": true, // íŒŒì† ë°œê²¬ ì—¬ë¶€
            "detections": [
              {
                "part": "Front_Bumper", // íŒŒì† ë¶€ìœ„ (ë²”í¼, ë„ì–´ ë“±)
                "damage_type": "Scratch", // íŒŒì† ì¢…ë¥˜ (ìŠ¤í¬ë˜ì¹˜, ë´íŠ¸ ë“±)
                "confidence": 0.88,
                "bbox": [100, 500, 200, 100]
              }
            ],
            "description": "ì• ë²”í¼ í•˜ë‹¨ì— ê¸í˜ ì†ìƒì´ ìˆìŠµë‹ˆë‹¤.",
            "repair_estimate": "ë¶€ë¶„ ë„ìƒ‰ ê¶Œì¥" // ì˜ˆìƒ ì¡°ì¹˜
          }
        }
        /*
        ì°¨ëŸ‰ ì™¸ê´€ ê°ì§€ ë¶€ìœ„ : part

        ì „ë©´ë¶€ (Front)	
        : ë³¸ë„¤íŠ¸(hood), ì• ë²”í¼(front_bumper), ì• ìœ ë¦¬(front_glass)
        í›„ë©´ë¶€ (Back)
        : íŠ¸ë í¬(trunk/tailgate), ë’· ë²”í¼(back_bumper), ë’· ìœ ë¦¬(back_glass)
        ì¸¡ë©´ ë° ë„ì–´ (Sides) 
        : ì•/ë’¤ ì™¼ìª½ ë¬¸(front_left_door, back_left_door), ì•/ë’¤ ì˜¤ë¥¸ìª½ ë¬¸(front_right_door, back_right_door)
        ë¼ì´íŠ¸ (Lights)	
        : ì• ì™¼ìª½/ì˜¤ë¥¸ìª½ ì „ì¡°ë“±(front_left_light, front_right_light), ë’¤ ì™¼ìª½/ì˜¤ë¥¸ìª½ í›„ë¯¸ë“±(back_left_light, back_right_light)
        ê¸°íƒ€ (Others)	
        : ì¢Œ/ìš° ì‚¬ì´ë“œ ë¯¸ëŸ¬(left_mirror, right_mirror), ë°”í€´ ë° íƒ€ì´ì–´(wheel)

        ì°¨ëŸ‰ ì™¸ê´€ íŒŒì† íƒì§€ : damage_type

        Dent (ë´íŠ¸/ì°Œê·¸ëŸ¬ì§)
        Scratch (ìŠ¤í¬ë˜ì¹˜/ê¸í˜)
        Crack (í¬ë™/ê· ì—´)
        Glass Shatter (ìœ ë¦¬ íŒŒì†)
        Lamp Broken (ë¨í”„ íŒŒì†)
        Tire Flat (íƒ€ì´ì–´ í‘í¬)

        */

        // 4. íƒ€ì´ì–´ ë¶„ì„ (SCENE_TIRE)
        {
          "status": "NORMAL", // NORMAL, WARNING, CRITICAL, ERROR
          "analysis_type": "SCENE_TIRE",
          "category": "TIRE",
          "data": {
            "wear_status": "GOOD", // GOOD(ì–‘í˜¸), DANGER(ìœ„í—˜)
            "wear_level_pct": 25, // ë§ˆëª¨ ì§„í–‰ë„ ì¶”ì • (% : 100%ì— ê°€ê¹Œìš¸ìˆ˜ë¡ êµì²´ ì‹œê¸°)
            "critical_issues": ["crack"], // ["cracked(ê· ì—´)", "flat(í‘í¬)", "bulge(ë¶€í’€ì–´ì˜¤ë¦„)", "uneven(í¸ë§ˆëª¨)"] ë˜ëŠ” null
            "description": "í™ˆì˜ ê¹Šì´ê°€ ì¶©ë¶„í•˜ë©° ë§ˆëª¨ í•œê³„ì„ ê³¼ì˜ ê±°ë¦¬ê°€ ë©€ì–´ ìƒíƒœê°€ ì–‘í˜¸í•©ë‹ˆë‹¤.", //null
            "recommendation": "í˜„ì¬ ìƒíƒœê°€ ì•„ì£¼ ì¢‹ìœ¼ë¯€ë¡œ ì •ê¸° ì •ë¹„ ì£¼ê¸°(ë§¤ 1ë§Œkm ìœ„ì¹˜ êµí™˜)ë¥¼ ìœ ì§€í•˜ì„¸ìš”.",
            "is_replacement_needed": false // íƒ€ì´ì–´ êµì²´: true
          }
        }
        ```

### 2. Audio Diagnosis (AST)
- **POST `/predict/audio`**
    - **Description**: ì—”ì§„/ë¶€í’ˆ ì†Œë¦¬ë¥¼ ë¶„ì„í•˜ì—¬ ì´ìƒ ìœ ë¬´ ë° ì›ì¸ íŒë³„.
    - **Request (Multipart)**:
        - `file`: ì˜¤ë””ì˜¤ íŒŒì¼ (.wav, .m4a)
    - **Response (JSON)**:
        ```json
        {
          "status": "NORMAL",
          "analysis_type": "AST",
          "category": "ENGINE",
          "detail": {
            "diagnosed_label": "ENGINE_NORMAL",
            "description": "ì •ìƒì ì¸ ì—”ì§„ êµ¬ë™ìŒì…ë‹ˆë‹¤. íŠ¹ì´ ì†ŒìŒì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
          },
          "confidence": 0.89,
          "is_critical": false
        }

        //diagnosed_label : anormalì¼ë•Œ
        /*
        bad_ignition
        brakes
        dead_battery
        low_oil
        power_steering 
        /*
        ```

### 3. Anomaly Detection (LSTM-AE. Core + Extension)
- **POST `/predict/anomaly`**
    - **Description**: ìµœê·¼ 60ì´ˆ ì‹œê³„ì—´ OBD ë°ì´í„°ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ Core(ì—”ì§„ LSTM-AE) ê¸°ë°˜ ì´ìƒ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê³ , 
                        ì„ íƒì ìœ¼ë¡œ í™•ì¥ ëª¨ë“ˆ(ì „ë ¥/ë¸Œë ˆì´í¬/íƒ€ì´ì–´/ì •ì§€ìƒíƒœ) ê²°ê³¼ë¥¼ í•¨ê»˜ ë°˜í™˜í•©ë‹ˆë‹¤.
    - **Request (JSON)**:
        ```json
        {
          "vehicle_id": "UUID-or-string",
          "mode": "DRIVING",
          "duration_sec": 60,
          "sampling_hz": 1,
          "timestamp_unit": "s",
          "data": [
            {
              "t": 0,
              "features": {
                "engine_coolant_temp_c": 86.2,
                "imap_kpa": 41.8,
                "engine_rpm": 2100,
                "vehicle_speed_kmh": 32.1,
                "intake_air_temp_c": 29.0,
                "maf_gps": 12.7,
                "throttle_pos_pct": 18.0,
                "ambient_air_temp_c": 27.0,
                "acc_pedal_pos_d_pct": 14.0,
                "acc_pedal_pos_e_pct": 14.0,

                "battery_voltage_v": 12.6,

                "brake_pressure_kpa": 0.0,
                "abs_active": 0,
                "wheel_speed_fl_kmh": 32.0,
                "wheel_speed_fr_kmh": 32.1,
                "wheel_speed_rl_kmh": 31.9,
                "wheel_speed_rr_kmh": 32.0,

                "tire_pressure_fl_kpa": 230.0,
                "tire_pressure_fr_kpa": 230.0,
                "tire_pressure_rl_kpa": 225.0,
                "tire_pressure_rr_kpa": 225.0
              }
            }
          ],
          "options": {
            "top_signals": "on_anomaly",
            "top_k": 3,
            "extensions": ["electrical", "brake", "tire", "idle"]
          }
        }
        ```
    - **Response (JSON)**:
        ```json
        {
          "core": {
            "domain": "engine",
            "score": 0.85,
            "threshold": 0.70,
            "is_anomaly": true,
            "top_signals": [
              { "feature": "engine_rpm", "contribution": 0.31 },
              { "feature": "imap_kpa", "contribution": 0.22 },
              { "feature": "throttle_pos_pct", "contribution": 0.12 }
            ]
          },
          "extensions": {
            "electrical": {
              "status": "OK",
              "is_abnormal": false,
              "signals": [
                {
                  "feature": "battery_voltage_v",
                  "value": 12.6,
                  "rule": "VOLTAGE_LOW",
                  "triggered": false
                }
              ]
            },
            "brake": {
              "status": "UNSUPPORTED",
              "reason": "brake_pressure_kpa not provided"
            },
            "tire": {
              "status": "OK",
              "is_abnormal": true,
              "signals": [
                {
                  "feature": "tire_pressure_rl_kpa",
                  "value": 185.0,
                  "rule": "TIRE_PRESSURE_LOW",
                  "triggered": true
                }
              ],
              "recommendation": "Rear-left tire pressure is low. Check tire pressure."
            },
            "idle": {
              "status": "SKIPPED",
              "reason": "mode=DRIVING"
            }
          }
        }
        ```

### 4. Wear Factor Prediction (XGBoost & Statistics)
- **POST `/predict/wear-factor`**
    - **Description**: ì°¨ëŸ‰ ëˆ„ì  ë°ì´í„° ë° ìš´ì „ ìŠµê´€(í†µê³„ ìš”ì•½)ì„ ê¸°ë°˜ìœ¼ë¡œ ì†Œëª¨í’ˆ ë…¸í™” ê³„ìˆ˜ ë° ìˆ˜ëª…ì„ ì˜ˆì¸¡. (Phase 2)
    - **Request (JSON)**:
        ```json
        {
          "vehicle_metadata": {
            "model_year": 2020,
            "fuel_type": "GASOLINE",
            "total_mileage": 52000
          },
          "driving_habits": {
            "avg_rpm": 2100.5,
            "hard_accel_count": 3,
            "hard_brake_count": 1,
            "idle_ratio": 0.15,
            "max_coolant_temp": 98.5,        // [NEW] ìµœê³  ëƒ‰ê°ìˆ˜ ì˜¨ë„
            "overheat_duration_sec": 120,    // [NEW] ê³¼ì—´ ì§€ì† ì‹œê°„
            "avg_engine_load": 45.2          // [NEW] í‰ê·  ì—”ì§„ ë¶€í•˜
          },
          "consumables_context": [
            {
              "item_code": "ENGINE_OIL",
              "last_replaced_date": "2023-05-15",
              "last_replaced_mileage": 45000,
              "is_inferred": false  
            },
            {
              "item_code": "COOLANT",
              "last_replaced_date": "2020-01-01", 
              "last_replaced_mileage": 0,
              "is_inferred": true 
            }
          ]
        }
        ```
    - **Response (JSON)**:
        ```json
        {
          "model_version": "v2.5-lightweight",
          "diagnosis_result": {
            "ENGINE_OIL": {
              "status": "NORMAL",             
              "wear_factor": 1.12,            
              "predicted_remaining_life": 28.5, 
              "correction_applied": false,    
              "message": "ë†’ì€ ì—”ì§„ ë¶€í•˜(45%)ê°€ ê°ì§€ë˜ì–´ ì˜¤ì¼ ìˆ˜ëª…ì´ ë‹¤ì†Œ ë¹ ë¥´ê²Œ ì¤„ê³  ìˆìŠµë‹ˆë‹¤."
            },
            "COOLANT": {
              "status": "WARNING",
              "wear_factor": 1.45,
              "predicted_remaining_life": 15.0,
              "correction_applied": true,     
              "message": "ì´ë²ˆ ì£¼í–‰ì—ì„œ ì—”ì§„ ê³¼ì—´ ìƒíƒœê°€ 2ë¶„ê°„ ì§€ì†ë˜ì—ˆìŠµë‹ˆë‹¤. ì ê²€ì„ ê¶Œì¥í•©ë‹ˆë‹¤."
            }
          }
        }
        ```

### 5. Text Embedding (Ollama)
- **POST `/embedding`**
    - **Description**: í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥ë°›ì•„ ë²¡í„°(ì„ë² ë”©)ë¥¼ ë°˜í™˜ (RAG ê²€ìƒ‰ìš©).
    - **Request (JSON)**:
        ```json
        {
            "text": "ì—”ì§„ ì˜¤ì¼ êµì²´ ì£¼ê¸°"
        }
        ```
    - **Response (JSON)**:
        ```json
        {
            "embedding": [0.123, -0.456, ...], // 1024 dimensions
        }
        ```

### 6. AI ì§„ë‹¨ í†µí•© (LLM Generation)
- **POST `/generate/diagnosis`**
    - **Description**: ìˆ˜ì§‘ëœ ëª¨ë“  ë©€í‹°ëª¨ë‹¬ ë°ì´í„°ì™€ RAG ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬, LLM ê¸°ë°˜ì˜ ìµœì¢… ì§„ë‹¨ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    - **Request (JSON)**:
        ```json
        {
            "diagnosis_context": {
                "overall_confidence": 0.85,  // ì‹œìŠ¤í…œ ê³„ì‚° ì¢…í•© ì‹ ë¢°ë„ (0.0~1.0)
                "data_sources": ["OBD", "SOUND", "MANUAL"],
                "is_confirmed_source": true  // OBD/DTC ë“± í™•ì • ë°ì´í„° í¬í•¨ ì—¬ë¶€
            },
            "vehicle_info": {
                "model": "Avante",
                "year": 2012,
                "fuel_type": "GASOLINE",
                "mileage": 150000
            },
            "consumables_status": [ // ì†Œëª¨í’ˆ ìˆ˜ëª… ì˜ˆì¸¡ ê²°ê³¼ ë° ê°€ì¤‘ì¹˜
                {
                    "item": "ENGINE_OIL",
                    "remaining_life": 0.45, // 45% ë‚¨ìŒ
                    "wear_factor": 1.2      // ê°€í˜¹ ì£¼í–‰ìœ¼ë¡œ 1.2ë°° ë¹ ë¥´ê²Œ ì†Œëª¨ ì¤‘
                }
            ],
            "analysis_results": { // ê°œë³„ ëª¨ë¸ ë¶„ì„ ê²°ê³¼ë“¤
                "sound": {
                    "detected": true,
                    "label": "Belt Slip",
                    "confidence": 0.8
                },
                "image": {
                    "detected": false
                },
                "lstm": {
                    "is_anomaly": true,
                    "anomaly_score": 0.9,
                    "factors": ["RPM"]
                }
            },
            "rag_context": [ // RAG ê²€ìƒ‰ ê²°ê³¼ (2010~2013 ë§¤ë‰´ì–¼)
                "ëƒ‰ê°ìˆ˜ ì˜¨ë„ê°€ 110ë„ ì´ìƒì¼ ê²½ìš° ê³¼ì—´ë¡œ ê°„ì£¼í•˜ë©°...",
                "(ì£¼ì˜: ë³¸ ë§¤ë‰´ì–¼ ì •ë³´ëŠ” 2010~2013ë…„ì‹ ê¸°ì¤€ì„)"
            ]
        }
        ```
    - **Response (JSON)**:
        ```json
        {
            "response_mode": "REPORT", // REPORT | INTERACTIVE
            "confidence_level": "HIGH",
            "summary": "ëƒ‰ê°ìˆ˜ ê³¼ì—´ì´ ê°ì§€ë©ë‹ˆë‹¤.",
            "report_data": {
                "suspected_causes": [
                    {
                        "cause": "ëƒ‰ê°ìˆ˜ ê³¼ì—´ (Overheating)",
                        "basis": "OBD ìˆ˜ì˜¨ 115ë„ ë° LSTM ì´ìƒ ê°ì§€",
                        "source_type": "CONFIRMED",
                        "reliability": "HIGH"
                    }
                ],
                "final_guide": "ì¦‰ì‹œ ì •ì°¨ í›„ ëƒ‰ê°ìˆ˜ ë ˆë²¨ì„ ì ê²€í•´ ì£¼ì„¸ìš”."
            },
            "interactive_data": null, // REPORT ëª¨ë“œì¼ ë• null
            "disclaimer": "ë³¸ ì§„ë‹¨ì€ 2010~2013ë…„ì‹ ë§¤ë‰´ì–¼ ë° AI ì¶”ë¡ ì— ê¸°ë°˜í•©ë‹ˆë‹¤."
        }
        ```
        *(ë§Œì•½ ë°ì´í„° ë¶€ì¡±ìœ¼ë¡œ **INTERACTIVE** ëª¨ë“œì¼ ê²½ìš° ì˜ˆì‹œ)*:
        ```json
        {
            "response_mode": "INTERACTIVE",
            "confidence_level": "LOW",
            "summary": "íŒë‹¨ ê²°ê³¼ê°€ ìƒì¶©ë˜ì–´ ì¶”ê°€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
            "report_data": null,
            "interactive_data": {
                "message": "ì„¼ì„œ ë°ì´í„°ëŠ” ì •ìƒì´ì§€ë§Œ ì†ŒìŒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë” ì •í™•í•œ ë¶„ì„ì„ ìœ„í•´ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
                "follow_up_questions": [
                    "ì‹œë™ì„ ëˆ ìƒíƒœì—ì„œë„ ì†Œë¦¬ê°€ ê³„ì† ë‚˜ë‚˜ìš”?",
                    "ìµœê·¼ì— ì—”ì§„ ì˜¤ì¼ì„ ì–¸ì œ êµì²´í•˜ì…¨ë‚˜ìš”?"
                ],
                "requested_actions": ["CAPTURE_PHOTO"]
            },
            "disclaimer": "ë³¸ ì§„ë‹¨ì€ íŒ©íŠ¸ê°€ ì•„ë‹Œ ì¶”ë¡  ê¸°ë°˜ì´ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤."
        }
        ```
