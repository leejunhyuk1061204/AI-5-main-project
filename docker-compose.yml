# =========================================================================
# ğŸš€ AI-5 Car-Sentry ì›í´ë¦­ ì¸í”„ë¼ ì„œë¹„ìŠ¤
# =========================================================================
# ğŸ’¡ [í•„ë…] ì‹¤í–‰ ì „ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ê¼­ í™•ì¸í•˜ì„¸ìš”!
#
# STEP 1. ì„¤ì • íŒŒì¼ ì¤€ë¹„ (.env ë§Œë“¤ê¸°)
#         í´ë”ì— ìˆëŠ” '.env.example' íŒŒì¼ì„ ë³µì‚¬í•´ì„œ ì´ë¦„ì„ '.env'ë¡œ ë°”ê¿”ì£¼ì„¸ìš”.
#         (ëª…ë ¹ì–´: copy .env.example .env)
#
# STEP 2. ì„œë²„ ì‹¤í–‰ (ìë™ ì„¤ì¹˜ í¬í•¨)
#         docker-compose up -d
#
# âš ï¸ ì£¼ì˜: Docker Desktopì´ ë°˜ë“œì‹œ ì¼œì ¸ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
# =========================================================================

version: '3.8'

services:
  # 1. ë°ì´í„°ë² ì´ìŠ¤ (PostgreSQL + TimescaleDB + pgvector)
  db:
    image: timescale/timescaledb-ha:pg15
    container_name: car-sentry-db
    restart: always
    environment:
      - POSTGRES_USER=${DB_USER:-postgres}
      - POSTGRES_PASSWORD=${DB_PASSWORD:-postgres}
      - POSTGRES_DB=${DB_NAME:-car_sentry}
    ports:
      - "${DB_PORT:-5432}:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql # ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ë§ˆìš´íŠ¸
    networks:
      - car-sentry-network

  # 2. ë©”ì‹œì§€ í (RabbitMQ)
  rabbitmq:
    image: rabbitmq:3.12-management
    container_name: car-sentry-mq
    restart: always
    environment:
      - RABBITMQ_DEFAULT_USER=${MQ_USER:-guest}
      - RABBITMQ_DEFAULT_PASS=${MQ_PASSWORD:-guest}
    ports:
      - "${MQ_PORT:-5672}:5672" # AMQP í¬íŠ¸
      - "${MQ_MANAGEMENT_PORT:-15672}:15672" # Management UI í¬íŠ¸
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    networks:
      - car-sentry-network

networks:
  car-sentry-network:
    driver: bridge

volumes:
  postgres_data:
  rabbitmq_data:
